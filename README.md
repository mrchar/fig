# 无花果

“无花果” 系统致力于打造一套高度灵活且功能完备的数据收集、处理及分析软件，
不仅能够实现简单业务场景的快速搭建，还可轻松迭代升级，从容支持复杂业务场景下的数据管理需求。

## 快速开始

### 后端

本项目后端使用`gradle`构建，请确保你安装了大于 17 版本的`jdk`，执行下面的命令进行构建。

```shell
# 切换到后端目录
cd server
# 如果使用windows系统，使用"./gradlew.bat"代替"./gradlew"
./gradlew clean build -x test
```

你可以使用下面的命令启动后端服务器。

```shell
# 接换到后端目录
cd server
# 启动服务器，将version更换为版本号
java -jar ./build/libs/fig-version.jar
```

### 前端

本项目前端使用`vite`构建，请确保你已经安装了大于 22 版本的`node`运行环境，执行下面的命令进行构建。

```shell
# 切换到前端目录
cd client
# 如果是第一次构建，需要先安装依赖
yarn install
# 确保已经正确安装依赖后，执行构建
yarn build
```

如果要启动调试服务器，执行下面的命令。

```shell
# 切换到前端目录
cd client
# 启动调试服务器
yarn dev
```

启动调试服务器后，访问`http://localhost:5173`打开服务，默认用户名 username，默认密码 password，正式发布时请修改用户名和密码。

### 容器化

如果你需要使用容器启动项目，我们也为你准备了构建配置和运行配置。`server`目录和`client`目录中均已包含 Dockerfile，同时我们也在构建工具中添加了构建命令。

在开始使用镜像启动服务前，请确定你已经正确安装了`docker`和`docker-compose`， 我们开发环境使用`docker desktop`安装。

使用下面的命令构建后端服务的镜像。

```shell
# 进入后端目录
cd server
# 执行构建命令
./gradlew buildImage
# 检查容器镜像
docker image ls
```

使用下面的命令构建前端服务的镜像。

```shell
# 进入前端目录
cd client
# 执行构建命令
yarn build:image
# 检查容器镜像
docker image ls
```

容器构建完成后，你可以使用根目录的`docker-compose`配置文件启动服务，你可以修改`.env`中的配置。

```shell
# 启动多个服务
docker compose up -d
```

启动后访问`https://localhost:3000`,默认用户名 username，默认密码 password。默认用户名密码仅用于调试，正式发布时请修改用户名和密码。

## 需求

在商业活动中，企业普遍需要通过多种途径收集客户及合作伙伴信息，并对采集到的数据进行系统性检查、深度处理与精准分析。
传统问卷系统虽能实现基础数据收集，但存在诸多局限性。

- 功能单一性：仅支持简单数据采集，缺乏数据校验与运算能力，难以满足复杂业务逻辑需求。
- 数据离散性：不同阶段创建的问卷，即便业务场景相同，因问卷结构变化，导致数据无法统一处理，增加了数据整合难度。
- 校验缺失：普通问卷系统未对数据有效性进行严格校验，用户提交的数据常存在无序、混乱问题，严重影响数据分析的准确性与效率。
- 逻辑薄弱：问卷字段间仅存在必填关联，难以实现复杂计算逻辑关联，无法满足数据动态处理需求。
- 流程断层：问卷之间缺乏上下游逻辑关系，无法依据业务进展实现数据的有序流转，限制了业务流程的自动化与规范化。
- 搭建与迭代难题：传统系统在简单业务场景搭建时效率低下，面对业务增长或需求变更，难以快速迭代以适配复杂场景。

## 功能

### 词汇表

词汇表聚焦于业务关键概念定义，统一系统数据含义，确保数据理解一致性。
词汇定义涵盖名称、数据类型、含义解析、校验约束等核心要素，支持复合词汇定义，通过属性及属性定义实现复杂概念描述。
同时，针对词汇在不同语境下的多义性，采用标签机制进行精准区分。
借助标准化的词汇管理，无论是简单业务快速启动，还是复杂业务拓展，都能保证数据语义的准确性与连贯性。

### 数据定义

数据定义功能通过定义概念属性、添加检查约束，对要收集的数据格式和信息进行规范，以此支持后续数据收集与分析。
其构成要素包括名称、属性定义、释义及校验约束，
同时支持在部分属性中配置计算表达式，使这些属性值可基于上下文数据自动计算得出，无需用户手动填写，从而实现复杂计算逻辑。

### 表单设计

完成数据格式定义后，数据收集工作随即展开。
为优化数据收集表单展示效果，需对表单外观进行精细化设计与控制，确保用户操作便捷、界面友好。
系统提供可视化的表单设计工具，在简单业务场景中，用户无需复杂编程，通过拖拽、配置等操作即可快速生成表单；
当业务升级时，可对表单进行动态调整，如添加字段、修改布局，实现表单功能的迭代优化。

### 函数开发

支持图形化与代码双模式编辑且实时同步，数据定义中可配置表达式实现属性值自动计算。
函数可集成至流程节点，通过条件分支、循环逻辑触发自动化流转。
提供沙箱测试、断点调试等工具保障执行准确性，内置基础函数库并支持自定义扩展与 AI 辅助生成。
通过角色权限控制访问范围，结合审计日志确保安全合规，提升平台开发效率与业务适配灵活性。

### 流程设计

在简单数据收集场景下，表单收集即可满足需求。
但面对复杂业务，需引入流程设计进行有效管控。
通过创建业务流程，依据不同条件实现一份或多份表单的智能流转，确保完整、准确地收集所需数据，推动业务流程高效运行。
流程设计采用模块化、图形化的设计理念，在业务初期，可快速搭建简易流程；
随着业务复杂度增加，能够通过添加流程节点、设置分支条件、调整流程顺序等方式，对流程进行迭代升级，无缝衔接复杂业务流程管理。

### 数据分析

数据分析功能致力于对收集数据进行深度挖掘，通过剖析数据间关系与内在规律，提炼出更具价值的信息，为业务决策提供有力支持。
无论是简单业务场景下的基础数据统计，还是复杂业务场景中的多维数据分析，系统都能通过预设算法和自定义分析模型，快速输出分析结果。
同时，可根据业务变化，灵活调整分析维度和算法，实现数据分析功能的持续迭代。

## 实现

### 数据定义

词汇表与数据定义同属元数据定义范畴，均采用 JsonSchema 进行标准化定义。
二者功能区分旨在适配不同业务场景：先利用词汇表明确领域概念，再基于概念组合构建数据定义集合。
数据定义功能在实现计算值时，需对 JsonSchema 进行扩展，添加自定义定义，以支持属性表达式配置。
这种标准化与可扩展的定义方式，使得在系统搭建初期，能够快速复用已有元数据模板，实现简单业务的数据定义；
当业务迭代时，方便对元数据进行修改和扩展，保障数据定义与业务发展同步。

### 表达式

表达式功能实现方式多样，其中编写 JavaScript ES5 代码并借助解释器执行是可行方案之一，[JS-Interpreter](https://github.com/NeilFraser/JS-Interpreter)可作为参考选型。
通过这种方式，无论是简单业务中的基础数据计算，还是复杂业务中的复杂逻辑运算，都能通过编写、修改表达式实现。
在业务迭代过程中，可随时更新表达式逻辑，快速响应业务规则的变化。

### 表单设计

为实现数据格式到表单的自动转换，推荐使用[json-forms](https://jsonforms.io/)库。
该库可基于 JsonSchema 和 ui-schema 快速生成符合需求的表单，简化表单设计流程，提高开发效率。
在系统搭建时，可利用其模板和配置功能，迅速生成适配简单业务的表单；
随着业务演进，通过修改 JsonSchema 和 UISchema 参数，就能实现表单的功能升级与样式优化。

### 流程设计

流程设计领域可选方案丰富，[Camunda](https://camunda.com/)是较为推荐的工具，前端配合[bpmn-js](https://bpmn.io/toolkit/bpmn-js/)可高效实现流程定义，满足复杂业务流程设计需求。
在项目初期，可使用其基础功能快速搭建简易流程；
当业务变得复杂时，借助其强大的流程编排和管理能力，通过可视化操作对流程进行重构、优化，轻松实现从简单流程到复杂流程的迭代升级。
